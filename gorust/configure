#!/bin/sh

SED_SUBST=""
TOP_DIR=`pwd`

LIBRUST="$TOP_DIR/rust/target/debug"

SED_SUBST="$SED_SUBST -e s|@TOP_DIR@|$TOP_DIR|g"
SED_SUBST="$SED_SUBST -e s|@LIBRUST@|$LIBRUST|g"

test -f config.status && rm -f config.status

{
	echo "cd $TOP_DIR"
	echo "SED_SUBST=\"$SED_SUBST\""
	echo "test -f Makefile && rm -f Makefile"
	echo "echo \"SED_SUBST = \$SED_SUBST\" > Makefile"
	echo "$TOP_DIR/sedsubst --append -w Makefile Makefile.in \$SED_SUBST"
	echo "$TOP_DIR/sedsubst -w bridge/bridge.go bridge/bridge.go.in \$SED_SUBST"
} > config.status

chmod +x-w config.status
./config.status

test -f config.reconf && rm -f config.reconf
{
	echo cd $TOP_DIR
	echo ./configure 
} > config.reconf
chmod +x-w config.reconf
